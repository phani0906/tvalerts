<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Stocks Scanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="scanner.css?v=5" />
    <script src="/socket.io/socket.io.js"></script>
    <style>
      .pivot-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 24px;
      }
      @media (max-width: 980px) {
        .pivot-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Floating toggle (upper-right) */
      .pivot-toggle-btn {
        position: fixed;
        top: 12px;
        right: 12px;
        z-index: 1000;
        padding: 8px 12px;
        background: #333;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.25);
      }
      .pivot-toggle-btn:hover { background: #444; }

      /* Vertical card layout for ANY pivot table */
      .vertical-table thead { display: none; }
      .vertical-table tbody tr {
        display: flex;
        flex-direction: column;
        border: 1px solid #3b3b3b;
        border-radius: 10px;
        padding: 8px 10px;
        margin-bottom: 10px;
        background: rgba(255,255,255,0.02);
      }
      .vertical-table tbody tr td { border: none !important; padding: 4px 0; }
      .vertical-table tbody tr td:first-child {
        font-weight: 700; font-size: 1.05em; opacity: 0.95; margin-bottom: 2px;
      }

      /* When stacked vertically, force the grid wrapper to behave like a block */
      .pivot-vertical-container.pivot-grid { display: block; }

      /* Optional: when stacked, give each container full width with a little spacing */
      .pivot-vertical-container .table-container { width: 100%; margin-bottom: 12px; }
    </style>
  </head>

  <body>
    <!-- Top scrolling quote -->
    <div id="quote-bar"><span id="quote-text">Loading quote...</span></div>
    <button id="pivotToggleBtn" class="pivot-toggle-btn">Pivot: Vertical</button>

    <!-- ===== Pivot/CPR (four tables) ===== -->
    <div class="pivot-grid" id="pivotGrid">
      <!-- 1) Bullish Continuation -->
      <div class="table-container buy-table">
        <h3 class="table-title buy-title">üìà Bullish Continuation</h3>
        <table id="pivotTableBullCont">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Pivot Rel.</th>
              <th>Open/Price</th>
              <th>Mid-point</th>
              <th>PDH</th>
              <th>Daily MA20</th>
              <th>Pivot Levels</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- 2) Bearish Continuation (moved above Bullish TR) -->
      <div class="table-container sell-table">
        <h3 class="table-title sell-title">üìâ Bearish Continuation</h3>
        <table id="pivotTableBearCont">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Pivot Rel.</th>
              <th>Open/Price</th>
              <th>Mid-point</th>
              <th>PDH</th>
              <th>Daily MA20</th>
              <th>Pivot Levels</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- 3) Bullish Trend Reversal -->
      <div class="table-container buy-table">
        <h3 class="table-title buy-title">üîÅ Bullish Trend Reversal</h3>
        <table id="pivotTableBullRev">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Pivot Rel.</th>
              <th>Open/Price</th>
              <th>Mid-point</th>
              <th>PDH</th>
              <th>Daily MA20</th>
              <th>Pivot Levels</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- 4) Bearish Trend Reversal -->
      <div class="table-container sell-table">
        <h3 class="table-title sell-title">üîÅ Bearish Trend Reversal</h3>
        <table id="pivotTableBearRev">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Pivot Rel.</th>
              <th>Open/Price</th>
              <th>Mid-point</th>
              <th>PDH</th>
              <th>Daily MA20</th>
              <th>Pivot Levels</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <!-- ===== /Pivot/CPR ===== -->

    <!-- GREEN ZONE (5m) -->
    <div class="table-container buy-table">
      <h3 class="table-title buy-title">üî• Green Zone (5mins)</h3>
      <table id="scannerTableBuy">
        <thead>
          <tr>
            <th>Time</th>
            <th>Ticker</th>
            <th>Alert</th>
            <th>Price</th>
            <th>MA20 (5m)</th>
            <th>VWAP (5m)</th>
            <th>DayMid</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- RED ZONE (5m) -->
    <div class="table-container sell-table">
      <h3 class="table-title sell-title">‚ö° Red Zone (5mins)</h3>
      <table id="scannerTableSell">
        <thead>
          <tr>
            <th>Time</th>
            <th>Ticker</th>
            <th>Alert</th>
            <th>Price</th>
            <th>MA20 (5m)</th>
            <th>VWAP (5m)</th>
            <th>DayMid</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- GREEN ZONE (15m) -->
    <div class="table-container buy-table">
      <h3 class="table-title buy-title">üî• Green Zone ‚Äî 15m</h3>
      <table id="scannerTableBuy15">
        <thead>
          <tr>
            <th>Time</th>
            <th>Ticker</th>
            <th>Alert</th>
            <th>Price</th>
            <th>MA20 (15m)</th>
            <th>VWAP (15m)</th>
            <th>DayMid</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- RED ZONE (15m) -->
    <div class="table-container sell-table">
      <h3 class="table-title sell-title">‚ö° Red Zone ‚Äî 15m</h3>
      <table id="scannerTableSell15">
        <thead>
          <tr>
            <th>Time</th>
            <th>Ticker</th>
            <th>Alert</th>
            <th>Price</th>
            <th>MA20 (15m)</th>
            <th>VWAP (15m)</th>
            <th>DayMid</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- GREEN ZONE (1h) -->
    <div class="table-container buy-table">
      <h3 class="table-title buy-title">üî• Green Zone ‚Äî 1h</h3>
      <table id="scannerTableBuy1h">
        <thead>
          <tr>
            <th>Time</th>
            <th>Ticker</th>
            <th>Alert</th>
            <th>Price</th>
            <th>MA20 (1h)</th>
            <th>VWAP (1h)</th>
            <th>DayMid</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- RED ZONE (1h) -->
    <div class="table-container sell-table">
      <h3 class="table-title sell-title">‚ö° Red Zone ‚Äî 1h</h3>
      <table id="scannerTableSell1h">
        <thead>
          <tr>
            <th>Time</th>
            <th>Ticker</th>
            <th>Alert</th>
            <th>Price</th>
            <th>MA20 (1h)</th>
            <th>VWAP (1h)</th>
            <th>DayMid</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Scripts -->
    <script src="pivotPanel.js?v=5" defer></script>
    <script src="scanner.js?v=13" defer></script>

    <!-- Pivot layout toggle (fixed order + vertical/horizontal) -->
    <script>
      (() => {
        // Desired fixed order
        const ORDER = ['pivotTableBullCont','pivotTableBearCont','pivotTableBullRev','pivotTableBearRev'];

        const btn = document.getElementById('pivotToggleBtn');
        const grid = document.getElementById('pivotGrid');

        function getItems() {
          return ORDER.map(id => {
            const tbl = document.getElementById(id);
            if (!tbl) return null;
            const container = tbl.closest('.table-container') || tbl.parentElement;
            return { id, tbl, container };
          }).filter(Boolean);
        }

        // Enforce fixed order once (always BC, BearC, BullR, BearR)
        function reorderFixed() {
          const items = getItems();
          if (!grid || items.length === 0) return;
          for (const id of ORDER) {
            const it = items.find(x => x.id === id);
            if (it) grid.appendChild(it.container);
          }
        }

        function setVertical(on) {
          const items = getItems();
          items.forEach(({ tbl }) => tbl.classList.toggle('vertical-table', on));
          if (grid) grid.classList.toggle('pivot-vertical-container', on);
          btn.textContent = on ? 'Pivot: Horizontal' : 'Pivot: Vertical';
        }

        // Init: lock order and default to horizontal
        reorderFixed();
        let vertical = false;

        btn.addEventListener('click', () => {
          vertical = !vertical;
          setVertical(vertical);
        });
      })();
    </script>
  </body>
</html>
